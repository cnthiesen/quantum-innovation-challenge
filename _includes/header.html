<script>
// Navigation Sphere JavaScript
document.addEventListener('DOMContentLoaded', function() {
  // SPHERE SIZE CONFIGURATION - Change this one value to scale the entire sphere
  const SPHERE_SIZE_PX = 32; // Change to 50 for a 50px sphere, 100 for 100px, etc.
  
  const sphereContainer = document.getElementById('navigationSphere');
  if (!sphereContainer) return;
  
  // Update container size dynamically
  sphereContainer.style.width = `${SPHERE_SIZE_PX}px`;
  sphereContainer.style.height = `${SPHERE_SIZE_PX}px`;
  
  const canvas = sphereContainer.querySelector('.sphere-canvas');
  const points = [];
  const cant = 120;
  const offset = 2 / cant;
  const increment = Math.PI * (3 - Math.sqrt(5));  
  let startTime = Date.now();

  // Calculate scaling factors based on sphere size
  const sphereRadius = (SPHERE_SIZE_PX - 4) / 2; // Leave 2px padding on each side
  const centerOffset = SPHERE_SIZE_PX / 2;

  // Initialize points
  function initializePoints() {
    for (let i = 0; i < cant; i++) {
      const point = document.createElement('div');
      point.className = 'absolute w-[1.5px] h-[1.5px] bg-white rounded-full transform-gpu transition-colors duration-500 ease-in-out group-hover:bg-quantum group-[.frontpage]/app:!bg-electron';
      canvas.appendChild(point);
      points.push({
        element: point,
        x: 0,
        y: 0,
        z: 0,
        scale: 0,
        opacity: 0
      });
    }
    updatePoints();
    // Start the animation loop
    animateSphere();
  }

  // Update point positions based on time for slow rotation
  function updatePoints() {
    const currentTime = Date.now();
    const elapsed = (currentTime - startTime) / 1000; // Convert to seconds
    
    // Slow rotation - adjust these values to change rotation speed
    const rotationSpeed = 0.3; // Radians per second (lower = slower)
    const angleX = elapsed * rotationSpeed * 0.5; // Rotate around X axis
    const angleY = elapsed * rotationSpeed; // Rotate around Y axis
    
    for (let i = 0; i < cant; i++) {
      const y = (i * offset - 1) + (offset / 2);
      const r = Math.sqrt(1 - Math.pow(y, 2));
      const a = ((i + 1) % cant) * increment + angleX;
      const x = Math.cos(a) * r;
      const z = Math.sin(a) * r;
      
      // Apply Y rotation
      const rotatedY = y * Math.cos(angleY) - z * Math.sin(angleY);
      const rotatedZ = y * Math.sin(angleY) + z * Math.cos(angleY);
      
      const scale = Math.round(rotatedZ * 20000) / 100;
      const opacity = (1 + rotatedZ) / 1.5;
      
      const point = points[i];
      if (point && point.element) {
        // Scale coordinates based on sphere size
        const translateX = centerOffset + x * sphereRadius;
        const translateY = centerOffset + rotatedY * sphereRadius;
        const translateZ = scale * 0.5;
        
        point.element.style.transform = `translate3d(${translateX}px, ${translateY}px, ${translateZ}px)`;
        point.element.style.opacity = opacity;
      }
    }
  }

  // Animation loop for continuous rotation
  function animateSphere() {
    updatePoints();
    requestAnimationFrame(animateSphere);
  }

  // Initialize the sphere
  initializePoints();
});

// Mobile menu toggle functionality
document.addEventListener('DOMContentLoaded', function() {
  const mobileMenuButton = document.getElementById('mobileMenuButton');
  const mobileMenu = document.getElementById('mobileMenu');
  const hamburgerIcon = document.getElementById('hamburgerIcon');
  const closeIcon = document.getElementById('closeIcon');
  
  // Close mobile menu function
  function closeMobileMenu() {
    if (mobileMenu && hamburgerIcon && closeIcon) {
      mobileMenu.classList.remove('translate-x-0');
      mobileMenu.classList.add('translate-x-full');
      hamburgerIcon.classList.remove('hidden');
      closeIcon.classList.add('hidden');
    }
  }
  
  // Make closeMobileMenu available globally
  window.closeMobileMenu = closeMobileMenu;
  
  if (mobileMenuButton && mobileMenu) {
    mobileMenuButton.addEventListener('click', function() {
      const isOpen = mobileMenu.classList.contains('translate-x-0');
      
      if (isOpen) {
        closeMobileMenu();
      } else {
        // Open menu
        mobileMenu.classList.remove('translate-x-full');
        mobileMenu.classList.add('translate-x-0');
        hamburgerIcon.classList.add('hidden');
        closeIcon.classList.remove('hidden');
      }
    });
    
    // Close menu when clicking outside 
    document.addEventListener('click', function(event) {
      if (!mobileMenu.contains(event.target) && !mobileMenuButton.contains(event.target)) {
        closeMobileMenu();
      }
    });
  }
});
</script>

<header class="group/header overflow-hidden w-full z-10 relative">
  {%- assign default_paths = site.pages | map: "path" -%}
  {%- assign page_paths = site.header_pages | default: default_paths -%}
  
  <div class="flex items-center justify-between transition-colors duration-500 ease-in-out border-quantum/25" id="siteName">
    <!-- Left side - Logo and Title -->
    <div class="flex border-electron/25 border-b-1 border-r-1 rounded-br-3xl items-center space-x-3 py-3.5 px-5 h-16 group relative overflow-hidden cursor-pointer">
      <a  class="flex items-center space-x-3" href="{{ "/" | relative_url }}">
      <!-- Canvas for animated points - size now controlled by JavaScript -->  
      <div id="navigationSphere" class="relative z-10"> 
        <div class="sphere-canvas relative w-full h-full"></div>
      </div>
      <!-- Title -->
      <h1 class="text-white font-medium group-hover:text-quantum transition-colors duration-500 ease-in-out z-10 group-[.frontpage]/app:!text-electron">
        <div class="lg:text-sm xl:text-base {% if page.url == "/" | relative_url %}active{% endif %}" rel="author">
          <span class=" hidden lg:hidden xl:block truncate overflow-hidden ">Quantum Innovation Challenge</span>
          <span class="xl:hidden">QIC-2025</span>
          
          <!-- {% if site.nav_title %}
            {{ site.nav_title }}
          {% else %}
            {{ site.title | escape }}
          {% endif %} -->
        </div>
      </h1>
      <div class="absolute inset-0 bg-electron transform -translate-x-full group-hover:translate-x-0 transition-transform duration-500 ease-in-out"></div>
      </a>
    </div>

    <!-- Desktop Navigation Links (hidden on mobile/tablet, shown on lg+) -->
    <nav class="hidden lg:flex flex-1 items-center space-x-8 py-3.5 px-5 justify-center h-16 font-space-mono">
      {%- for path in page_paths -%}
        {%- assign node = site.pages | where: "path", path | first -%}
        {%- if node.title -%}
          {%- if (node.event_status contains event_status) or (node.event_status == blank) or (event_status == "demo") -%}
            <a class="text-sm  lg:text-sm xl:text-base text-white cursor-pointer hover:text-electron transition-colors  {% if page.url == node.url %}text-electron!{% endif %}" href="{{ node.url | relative_url }}">
              {% if node.menu_icon %}<i class="bi bi-{{ node.menu_icon | escape }}"></i>{% endif %}
              {% if node.menu_title %}
                <span>{{ node.menu_title | escape }}</span>
              {% else %}
                <span>{{ node.title | escape }}</span>
              {% endif %}
            </a>
          {%- endif -%}
        {%- endif -%}
      {%- endfor -%}
    </nav>

    <!-- Mobile menu button (visible on mobile/tablet, hidden on lg+) -->
    <button id="mobileMenuButton" class="lg:hidden flex items-center text-white border-b border-l border-electron/25 rounded-bl-3xl py-3.5 px-5 h-16 cursor-pointer transition-all duration-300 ease-in-out hover:!text-quantum relative overflow-hidden group">
      <!-- Hamburger icon -->
      <div id="hamburgerIcon" class="relative z-10">
        <div class="w-6 h-6 flex flex-col justify-center items-center">
          <div class="w-4 h-0.5 bg-current mb-1 md:w-5 md:h-0.5"></div>
          <div class="w-4 h-0.5 bg-current mb-1 md:w-5 md:h-0.5"></div>
          <div class="w-4 h-0.5 bg-current md:w-5 md:h-0.5"></div>
        </div>
      </div>
      <!-- Close icon -->
      <div id="closeIcon" class="hidden relative z-10">
        <div class="w-6 h-6 flex justify-center items-center">
          <div class="w-4 h-0.5 bg-current transform rotate-45 absolute md:w-5 md:h-0.5"></div>
          <div class="w-4 h-0.5 bg-current transform -rotate-45 absolute md:w-5 md:h-0.5"></div>
        </div>
      </div>
      <div class="absolute inset-0 bg-electron transform -translate-x-full group-hover:translate-x-0 transition-transform duration-500 ease-in-out"></div>
    </button>

    <!-- Desktop Register Button (hidden on mobile/tablet, shown on lg+) -->
    <button id="registerTeamButton" class="lg:text-sm xl:text-base hidden lg:flex items-center text-white border-b border-l border-electron/25 rounded-bl-3xl py-3.5 px-5 h-16 cursor-pointer transition-all duration-300 ease-in-out hover:!text-quantum relative overflow-hidden group" onclick="openRegistrationModal()">
      <span class="relative z-10">
        <span class="hidden lg:block">Register</span>
          <span class="lg:hidden">Register</span>
      </span>
      <div class="absolute inset-0 bg-electron transform -translate-x-full group-hover:translate-x-0 transition-transform duration-500 ease-in-out"></div>
    </button>
  </div>

  <!-- Mobile Menu (slides in from right) -->
  <div id="mobileMenu" class="lg:hidden fixed top-0 right-0 h-full w-80 bg-quantum transform translate-x-full transition-transform duration-300 ease-in-out z-50 border-l border-electron/25">
    <div class="flex flex-col h-full">
      <!-- Mobile menu header -->
      <div class="flex items-center justify-between p-5 border-b border-electron/25">
        <h2 class="text-white font-bold">Navigation</h2>
           <div id="closeIcon" class="relative z-10 cursor-pointer" onclick="closeMobileMenu()" >
        <div class="w-6 h-6 flex justify-center items-center">
          <div class="w-4 h-0.5 bg-current transform rotate-45 absolute"></div>
          <div class="w-4 h-0.5 bg-current transform -rotate-45 absolute"></div>
        </div>
      </div>
        <!-- <img src="{{ site.baseurl }}/assets/icons/close.svg" alt="Close" class="w-4 h-4 cursor-pointer" onclick="closeMobileMenu()"> --> 
      </div>
      
      <!-- Mobile navigation links -->
      <nav class="flex-1 flex flex-col space-y-2 font-space-mono">
        {%- for path in page_paths -%}
          {%- assign node = site.pages | where: "path", path | first -%}
          {%- if node.title -%}
            {%- if (node.event_status contains event_status) or (node.event_status == blank) or (event_status == "demo") -%}
              <a class="text-white cursor-pointer hover:text-electron transition-colors group-[.frontpage]/app:!text-white {% if page.url == node.url %}active text-quantum{% endif %} py-3 px-2 border-b border-electron/10" href="{{ node.url | relative_url }}">
                {% if node.menu_icon %}<i class="bi bi-{{ node.menu_icon | escape }} mr-3"></i>{% endif %}
                {% if node.menu_title %}
                  <span>{{ node.menu_title | escape }}</span>
                {% else %}
                  <span>{{ node.title | escape }}</span>
                {% endif %}
              </a>
            {%- endif -%} 
          {%- endif -%}
        {%- endfor -%}
      </nav>
      
      <!-- Mobile register button -->
      <div class="p-5 border-t border-electron/25">
        <button class="w-full  flex items-center justify-center text-white bg-electron/20 hover:bg-electron/40 rounded-lg py-3.5 px-5 cursor-pointer transition-all duration-300 ease-in-out hover:text-quantum border border-electron/25" onclick="openRegistrationModal()">
          <span class="">Register your team</span>
        </button>
      </div>
    </div>
  </div>
</header>

